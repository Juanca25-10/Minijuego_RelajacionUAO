<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Actividades - UAO Stress App</title>
    
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>

        /* --- ESTILOS PARA LA NUEVA SECCI√ìN DE ACTIVIDADES UAO --- */
        .uni-activities-grid-v6 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .uni-activity-card {
            background-color: var(--color-background);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .uni-activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(156, 31, 55, 0.15); /* Sombra con toque UAO */
        }

        .card-image-container {
            height: 180px;
            overflow: hidden;
        }
        
        .card-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .uni-activity-card:hover .card-image-container img {
            transform: scale(1.05);
        }

        .card-content {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .card-content h3 {
            color: var(--color-primary);
            font-size: 1.4rem; /* Subimos ligeramente el tama√±o, estaba en 1.3rem */
            margin-bottom: 5px;
            
            /* PROPIEDADES CLAVE PARA TRUNCAR EL TEXTO */
            white-space: nowrap;          /* Fuerza el texto a una sola l√≠nea */
            overflow: hidden;             /* Oculta el texto que se desborda */
            text-overflow: ellipsis;      /* Muestra "..." al final de la l√≠nea */
        }

        .card-content p {
            font-size: 0.95rem;
            color: var(--color-secondary);
            margin-bottom: 15px;
            flex-grow: 1; /* Para empujar el footer/bot√≥n hacia abajo */
        }

        .card-date {
            font-size: 0.85rem;
            color: var(--color-primary);
            font-weight: 600;
            margin-bottom: 10px;
        }
        /* Animaci√≥n suave (Se mantiene) */
        @keyframes fadeGrow {
            from { opacity: 0; transform: scale(0.97); }
            to { opacity: 1; transform: scale(1); }
        }
        .anim-fade-grow {
            opacity: 0;
            animation: fadeGrow 0.8s cubic-bezier(0.25, 1, 0.5, 1) forwards;
        }
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.3s; }
        .delay-3 { animation-delay: 0.5s; }

        /* --- ESTILOS DEL BANNER (ACTUALIZADOS) --- */
        .subpage-banner-v6 {
            background-color: var(--color-dark-surface);
            color: var(--color-secondary);
            padding: 100px 5%;
            text-align: center;
            border-radius: 12px;
            margin: 0 1%; 
        }
        .subpage-banner-v6 .title {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 25px;
            position: relative;
            display: inline-block;
            padding-bottom: 15px;
        }
        .subpage-banner-v6 .title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background-color: var(--color-secondary);
            border-radius: 2px;
        }
        .subpage-banner-v6 .tagline {
            font-size: 1.25rem;
            color: #555;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* --- LAYOUT DE 2 COLUMNAS (Se mantiene) --- */
        .gestion-layout {
            display: grid;
            grid-template-columns: 1fr 1.5fr; 
            gap: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }
        @media (max-width: 1024px) {
            .gestion-layout {
                grid-template-columns: 1fr;
            }
        }

        /* --- CSS PARA CALENDARIO (Se mantiene) --- */
        .calendar-container {
            background-color: var(--color-background);
            border: 1px solid #EAEAEA; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(156, 31, 55, 0.1); 
            padding: 25px;
            align-self: start; 
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .calendar-header h3 {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--color-secondary);
            margin: 0;
        }
        .calendar-nav button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-primary);
            padding: 5px 10px;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        .calendar-nav button:hover {
            background-color: var(--color-dark-surface);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px; 
        }
        .calendar-day-name {
            font-weight: 600;
            font-size: 0.8rem;
            text-align: center;
            color: #555;
            margin-bottom: 5px;
        }
        .calendar-day {
            padding: 10px 5px; 
            text-align: center;
            border: 1px solid transparent; 
            border-radius: 8px;
            font-weight: 600;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .calendar-day:hover:not(.other-month) {
            background-color: var(--color-subtle-background);
            border-color: var(--color-primary);
        }
        .calendar-day.other-month {
            opacity: 0.3;
            pointer-events: none;
        }
        .calendar-day.today {
            background-color: var(--color-primary);
            color: var(--color-light-text);
            border-color: var(--color-primary);
        }
        .calendar-day.selected {
            background-color: #1E1E1E;
            color: var(--color-light-text);
            border-color: #1E1E1E;
        }
        .calendar-day .task-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: var(--color-primary);
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
        }
        .calendar-day.today .task-dot {
            background-color: var(--color-light-text);
        }

        /* --- CSS PARA TARJETAS DE TAREA (Se mantiene) --- */
        .task-list-container { }
        
        .add-task-button-container {
            margin-bottom: 30px;
        }
        #open-task-modal-btn {
            width: 100%;
            font-size: 1.2rem;
            padding: 15px;
        }
        .task-card-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        .task-card {
            background-color: var(--color-background);
            border: 1px solid #EAEAEA; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(156, 31, 55, 0.1); 
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(156, 31, 55, 0.15);
        }
        .task-card-content { padding: 20px; }
        .task-card-content h3 {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 10px;
        }
        .task-card-content p {
            font-size: 1rem;
            color: var(--color-secondary);
            margin-bottom: 5px;
            line-height: 1.5;
        }
        .task-card-details {
            padding: 0 20px 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
        }
        .task-card-details span { margin-right: 5px; }
        .task-card-attachment {
            padding: 5px 10px;
            background: var(--color-dark-surface);
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
        }
        .task-card-footer {
            padding: 15px 20px;
            border-top: 1px solid #EAEAEA;
            background-color: var(--color-subtle-background);
            border-radius: 0 0 12px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .task-card-footer .checkbox-container {
            display: flex;
            align-items: center;
        }
        .task-card-footer label {
            flex-grow: 1;
            margin-left: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            color: #333;
        }
        .task-card-footer input[type="checkbox"] {
            appearance: none;
            width: 22px;
            height: 22px;
            border: 2px solid var(--color-primary);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
        }
        .task-card-footer input[type="checkbox"]:checked {
            background-color: var(--color-primary);
        }
        .task-card-footer input[type="checkbox"]:checked::before {
            content: '‚úî';
            color: white;
            position: absolute;
            top: -2px;
            left: 2px;
            font-size: 16px;
        }
        .delete-btn {
            background: none;
            border: 1px solid #ddd;
            color: var(--color-primary);
            font-weight: 800;
            font-size: 1rem;
            padding: 5px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .delete-btn:hover {
            background-color: var(--color-primary);
            color: var(--color-light-text);
            border-color: var(--color-primary);
        }
        .task-card.completed { opacity: 0.7; }
        .task-card.completed h3,
        .task-card.completed p,
        .task-card.completed label,
        .task-card.completed .task-card-details {
            text-decoration: line-through;
        }

        /* --- CSS PARA EL MODAL DE A√ëADIR TAREA (Se mantiene) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            display: none; 
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: var(--color-background);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 800px;
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        .modal-form-col {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .modal-form-col h2 {
            color: var(--color-primary);
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .modal-form-col label {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: -5px;
        }
        .modal-form-col input[type="text"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #EAEAEA;
            border-radius: 8px;
            font-family: var(--font-family-main);
            font-size: 1rem;
        }
        .modal-form-col textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #EAEAEA;
            border-radius: 8px;
            font-family: var(--font-family-main);
            font-size: 1rem;
            resize: vertical;
            min-height: 80px;
        }
        .modal-form-col .cta-btn {
            width: 100%;
            margin-top: 10px;
        }

        /* --- ESTILOS PARA LIMITAR LA LISTA DE TAREAS --- */
        .task-list-container {
            position: relative;
            /* Asegura que el contenedor de la lista de tareas tenga espacio */
        }
        
        .task-list-wrapper {
           max-height: 500px; /* L√≠mite de altura. Si hay m√°s, aparece el scroll. */
            overflow-y: auto; /* Habilita el scroll vertical */
            position: relative;
            
            /* CAMBIO CLAVE 1: Ocultar barra de scroll para WebKit (Chrome, Safari, Edge) */
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        /* CAMBIO CLAVE 2: Ocultar barra de scroll para navegadores WebKit */
        .task-list-wrapper::-webkit-scrollbar {
            display: none;
        }

        /* La clase 'collapsed' es la que limita la altura para el modo inicial */
        .task-list-wrapper.collapsed {
            max-height: 480px; 
        }

        /* Efecto de desvanecimiento para indicar que hay m√°s contenido */
        .task-list-wrapper.collapsed::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px; /* Altura del degradado */
            background: linear-gradient(to top, var(--color-background), transparent);
            pointer-events: none; /* Permite hacer clic en el bot√≥n de abajo */
        }

        /* Estilo para el bot√≥n de despliegue */
        #toggle-tasks-btn {
            margin-top: 15px;
        }

        /* --- ESTILOS PARA SCROLL HORIZONTAL DE ACTIVIDADES UAO --- */
        .horizontal-scroll-wrapper {
            /* Oculta lo que se desborda y permite el scroll horizontal */
            overflow-x: auto; 
            overflow-y: hidden;
            
            /* Asegura que el contenedor de las tarjetas no se rompa */
            white-space: nowrap; 
            padding-bottom: 20px; /* Espacio para que la barra de scroll no toque las tarjetas */
        }
        
        /* Modificamos el contenedor interno para que sus hijos est√©n en l√≠nea */
        .uni-activities-grid-v6 {
            /* Desactiva el Grid Layout normal para forzar el flujo horizontal */
            display: flex; 
            
            /* Permite que el contenido siga en una sola l√≠nea */
            flex-wrap: nowrap; 
            
            /* Mantiene la separaci√≥n entre las tarjetas */
            gap: 30px; 
            
            /* Elimina el l√≠mite de ancho para que crezca horizontalmente */
            max-width: none; 
            margin: 0;
            padding: 0;
        }

        /* Ajustamos el tama√±o de la tarjeta para que tenga un ancho fijo y se deslice */
        .uni-activity-card {
            /* Anchura fija para que la tarjeta no se comprima */
            flex: 0 0 320px; 
            width: 320px;
        }

        /* Opcional: Estilo de la barra de scroll (solo para navegadores WebKit como Chrome/Safari) */
        .horizontal-scroll-wrapper::-webkit-scrollbar {
            height: 8px;
        }
        .horizontal-scroll-wrapper::-webkit-scrollbar-thumb {
            background-color: var(--color-primary); /* Rojo UAO */
            border-radius: 10px;
        }
        .horizontal-scroll-wrapper::-webkit-scrollbar-track {
            background-color: var(--color-dark-surface);
        }

        /* CSS para Tareas de Ejemplo (Ocultar) */
        .example-task { display: none; }
    </style>
</head>
<body>
    
    <div id="data-card-container" class="hidden">
        <div class="data-card">
            <h3 class="card-title"></h3>
            <p class="card-subtitle"></p>
            <p class="card-description"></p>
            <div class="card-stats"></div>
            </div>
    </div>

    <header id="main-header">
        <div class="logo">UAO Stress App</div>
        <nav>
            <ul class="nav-links">
                <li><a href="index.html" style="font-weight: 600;"><span>&larr; Regresar</span></a></li>
            </ul>
        </nav>
        <button class="cta-btn"><span>Ingresar texto de boton</span></button>
    </header>

    <main>
    <section class="subpage-banner-v6 anim-fade-grow delay-1">
        <h1 class="title">Gesti√≥n de Actividades</h1>
        <p class="tagline">
            Organiza tus tareas, gestiona tu tiempo y reduce el estr√©s acad√©mico.
        </p>
    </section>

    <section id="uni-activities-section" class="section-padding anim-fade-grow delay-3">
            <h2 class="section-title" style="text-align: center; margin-bottom: 50px;">
                Actividades de Bienestar UAO
                <span>‚Äî Reduce tu estr√©s ‚Äî</span>
            </h2>
            
            <div class="horizontal-scroll-wrapper">
                <div id="uni-activities-grid" class="uni-activities-grid-v6">
                    </div>
            </div>
            </section>
    
    <section class="section-padding">
        <div class="gestion-layout anim-fade-grow delay-2">

            <div class="calendar-container">
                <div class="calendar-header">
                    <button id="calendar-prev">&larr;</button>
                    <h3 id="current-month-year">Cargando...</h3>
                    <button id="calendar-next">&rarr;</button>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-name">Dom</div>
                    <div class="calendar-day-name">Lun</div>
                    <div class="calendar-day-name">Mar</div>
                    <div class="calendar-day-name">Mi√©</div>
                    <div class="calendar-day-name">Jue</div>
                    <div class="calendar-day-name">Vie</div>
                    <div class="calendar-day-name">S√°b</div>
                </div>
                <div class="calendar-grid" id="calendar-grid-body"></div>
            </div>

            <div class="task-list-container">
                <h2 class="section-title" style="margin-bottom: 25px;">Tareas Pendientes</h2>
                
                <div class="add-task-button-container">
                    <button class="cta-btn" id="open-task-modal-btn">+ A√±adir Tarea Nueva</button>
                </div>
                
                <div id="task-list-wrapper" class="task-list-wrapper collapsed"> 
                    <div class="task-card-grid" id="task-grid">
                        <div class="task-card example-task" data-id="task-example-1"></div>
                        <div class="task-card completed example-task" data-id="task-example-2"></div>
                    </div>
                </div>
            </div>

        </div>
    </section>
</main>

    <div class="modal-overlay" id="add-task-modal">
        <div class="modal-content">
            <div class="modal-form-col">
                <h2>A√±adir Nueva Tarea</h2>
                <form id="modal-task-form">
                    <label for="modal-task-title">T√≠tulo de la Tarea</label>
                    <input type="text" id="modal-task-title" placeholder="Ej: Entregar Proyecto 3" required>
                    <label for="modal-task-desc">Descripci√≥n</label>
                    <textarea id="modal-task-desc" placeholder="Ej: Subir propuesta y prototipo..."></textarea>
                    <label for="modal-task-time">Hora</label>
                    <input type="text" id="modal-task-time" placeholder="Ej: 2:30 PM">
                    <button type="submit" class="cta-btn"><span>Guardar Tarea</span></button>
                </form>
            </div>
            <div class="modal-calendar-col">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button id="modal-calendar-prev">&larr;</button>
                        <h3 id="modal-month-year">Cargando...</h3>
                        <button id="modal-calendar-next">&rarr;</button>
                    </div>
                    <div class="calendar-grid">
                        <div class="calendar-day-name">Dom</div>
                        <div class="calendar-day-name">Lun</div>
                        <div class="calendar-day-name">Mar</div>
                        <div class="calendar-day-name">Mi√©</div>
                        <div class="calendar-day-name">Jue</div>
                        <div class="calendar-day-name">Vie</div>
                        <div class="calendar-day-name">S√°b</div>
                    </div>
                    <div class="calendar-grid" id="modal-calendar-grid-body"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Referencias DOM para el nuevo Desplegable
            const taskListWrapper = document.getElementById('task-list-wrapper');
            const toggleTasksBtn = document.getElementById('toggle-tasks-btn');
            
            // --- NUEVA FUNCI√ìN: Toggle para Mostrar/Ocultar Tareas ---
            if (toggleTasksBtn && taskListWrapper) {
                toggleTasksBtn.addEventListener('click', () => {
                    // Alterna la clase 'collapsed'
                    taskListWrapper.classList.toggle('collapsed');
                    
                    // Actualiza el texto del bot√≥n
                    if (taskListWrapper.classList.contains('collapsed')) {
                        toggleTasksBtn.textContent = 'Mostrar todas las tareas';
                    } else {
                        toggleTasksBtn.textContent = 'Ocultar tareas';
                    }
                });
            }

            const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
            const today = new Date();
            const taskGrid = document.getElementById('task-grid');

            // --- 1. L√ìGICA DE DATOS (localStorage) ---
            const STORAGE_KEY = 'uaoTasks';
            function getTasks() {
                return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            }
            function saveTasks(tasks) {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
                // *** NUEVO ***: Refresca el calendario principal despu√©s de guardar
                renderMainCalendar(mainCalYear, mainCalMonth);
            }

            // --- 2. L√ìGICA DE RENDERIZADO DE TAREAS ---
            function createTaskCardElement(task) {
                const card = document.createElement('div');
                card.classList.add('task-card');
                if (task.completed) card.classList.add('completed');
                card.dataset.id = task.id; 

                const formattedDate = task.date ? new Date(task.date).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' }) : '(Sin fecha)';
                const time = task.time || '(Sin hora)';

                card.innerHTML = `
                    <div class="task-card-content">
                        <h3>${task.title}</h3>
                        <p><strong>Descripci√≥n:</strong> ${task.desc || '(Sin descripci√≥n)'}</p>
                    </div>
                    <div class="task-card-details">
                        <div><span>üìÖ</span>${formattedDate}</div>
                        <div><span>üïí</span>${time}</div>
                        <button class="task-card-attachment">Adjuntar Prueba</button>
                    </div>
                    <div class="task-card-footer">
                        <div class="checkbox-container">
                            <input type="checkbox" id="${task.id}" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                            <label for="${task.id}">Completada</label>
                        </div>
                        <button class="delete-btn">Eliminar</button>
                    </div>
                `;
                return card;
            }

            function loadTasks() {
                taskGrid.innerHTML = ''; 
                const tasks = getTasks();
                
                if (tasks.length === 0) {
                    document.querySelectorAll('.example-task').forEach(taskEl => {
                        taskEl.style.display = 'flex'; 
                        taskGrid.appendChild(taskEl); 
                    });
                } else {
                    tasks.forEach(task => {
                        taskGrid.appendChild(createTaskCardElement(task));
                    });
                }
            }

            // --- 3. L√ìGICA DEL MODAL ---
            const modal = document.getElementById('add-task-modal');
            const openModalBtn = document.getElementById('open-task-modal-btn');
            const taskForm = document.getElementById('modal-task-form');
            let selectedDate = new Date(); 
            
            openModalBtn.addEventListener('click', () => {
                modal.style.display = 'flex';
                selectedDate = new Date(); 
                renderModalCalendar(selectedDate.getFullYear(), selectedDate.getMonth());
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.style.display = 'none';
            });

            taskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const tasks = getTasks();
                const newTask = {
                    id: `task-${Date.now()}`,
                    title: document.getElementById('modal-task-title').value,
                    desc: document.getElementById('modal-task-desc').value,
                    time: document.getElementById('modal-task-time').value,
                    date: selectedDate.toISOString(), 
                    completed: false
                };

                tasks.push(newTask);
                saveTasks(tasks); // Esto tambi√©n refrescar√° el calendario (ver L√≥gica 1)
                loadTasks(); 
                
                modal.style.display = 'none';
                taskForm.reset();
            });

            // --- 4. L√ìGICA DE CALENDARIO (REUTILIZABLE) ---
            
            // *** NUEVO ***: Referencias a la tarjeta flotante
            const dataCardContainer = document.getElementById('data-card-container');
            const cardTitle = dataCardContainer.querySelector('.card-title');
            const cardSubtitle = dataCardContainer.querySelector('.card-subtitle');
            const cardDescription = dataCardContainer.querySelector('.card-description');
            const cardStats = dataCardContainer.querySelector('.card-stats');

            /**
             * Renderiza un calendario en un contenedor espec√≠fico.
             * @param {number} year - El a√±o a renderizar.
             * @param {number} month - El mes a renderizar (0-indexado).
             * @param {string} monthYearElId - ID del elemento <h3> para el t√≠tulo.
             * @param {string} gridBodyId - ID del <div> para los d√≠as.
             * @param {boolean} isModalCalendar - True si es el calendario del modal.
             */
            function renderCalendar(year, month, monthYearElId, gridBodyId, isModalCalendar = false) {
                const monthYearEl = document.getElementById(monthYearElId);
                const gridBody = document.getElementById(gridBodyId);

                gridBody.innerHTML = '';
                monthYearEl.textContent = `${monthNames[month]} ${year}`;

                // *** NUEVO ***: Carga las tareas *antes* del bucle
                const allTasks = getTasks();

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                for (let i = 0; i < firstDayOfMonth; i++) {
                    gridBody.appendChild(document.createElement('div')).classList.add('calendar-day', 'other-month');
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayEl = document.createElement('div');
                    dayEl.classList.add('calendar-day');
                    dayEl.textContent = i;
                    
                    const dayDate = new Date(year, month, i);

                    if (!isModalCalendar && i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                        dayEl.classList.add('today');
                    }
                    
                    if (isModalCalendar && i === selectedDate.getDate() && month === selectedDate.getMonth() && year === selectedDate.getFullYear()) {
                        dayEl.classList.add('selected');
                    }

                    // *** NUEVO: L√ìGICA DE PUNTO DE TAREA Y HOVER ***
                    if (!isModalCalendar) {
                        // Compara la fecha ignorando la hora
                        const tasksForDay = allTasks.filter(task => {
                            const taskDate = new Date(task.date);
                            return taskDate.getDate() === i &&
                                   taskDate.getMonth() === month &&
                                   taskDate.getFullYear() === year;
                        });

                        if (tasksForDay.length > 0) {
                            // 1. A√±ade el punto
                            const dot = document.createElement('div');
                            dot.classList.add('task-dot');
                            dayEl.appendChild(dot);

                            // 2. A√±ade los listeners de hover
                            const hoverTask = tasksForDay[0]; // Muestra la primera tarea
                            
                            dayEl.addEventListener('mouseover', (e) => {
                                showTaskHoverCard(e, hoverTask);
                            });
                            dayEl.addEventListener('mouseleave', () => {
                                hideTaskHoverCard();
                            });
                            dayEl.addEventListener('mousemove', (e) => {
                                if (dataCardContainer.classList.contains('visible')) {
                                    updateCardPosition(e.clientX, e.clientY);
                                }
                            });
                        }
                    }
                    
                    if (isModalCalendar) {
                        dayEl.addEventListener('click', () => {
                            selectedDate = dayDate;
                            renderModalCalendar(year, month);
                        });
                    }
                    gridBody.appendChild(dayEl);
                }
            }

            // Calendario Principal
            let mainCalYear = today.getFullYear();
            let mainCalMonth = today.getMonth();
            document.getElementById('calendar-prev').addEventListener('click', () => {
                mainCalMonth--;
                if (mainCalMonth < 0) { mainCalMonth = 11; mainCalYear--; }
                renderMainCalendar(mainCalYear, mainCalMonth);
            });
            document.getElementById('calendar-next').addEventListener('click', () => {
                mainCalMonth++;
                if (mainCalMonth > 11) { mainCalMonth = 0; mainCalYear++; }
                renderMainCalendar(mainCalYear, mainCalMonth);
            });
            function renderMainCalendar(y, m) {
                renderCalendar(y, m, 'current-month-year', 'calendar-grid-body', false);
            }
            
            // Calendario del Modal
            let modalCalYear = selectedDate.getFullYear();
            let modalCalMonth = selectedDate.getMonth();
            document.getElementById('modal-calendar-prev').addEventListener('click', () => {
                modalCalMonth--;
                if (modalCalMonth < 0) { modalCalMonth = 11; modalCalYear--; }
                renderModalCalendar(modalCalYear, modalCalMonth);
            });
            document.getElementById('modal-calendar-next').addEventListener('click', () => {
                modalCalMonth++;
                if (modalCalMonth > 11) { modalCalMonth = 0; modalCalYear++; }
                renderModalCalendar(modalCalYear, modalCalMonth);
            });
            function renderModalCalendar(y, m) {
                modalCalYear = y;
                modalCalMonth = m;
                renderCalendar(y, m, 'modal-month-year', 'modal-calendar-grid-body', true);
            }
            
            // --- 5. EVENT DELEGATION (Completar y Eliminar) ---
            taskGrid.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-btn')) {
                    const card = e.target.closest('.task-card');
                    const taskId = card.dataset.id;
                    let tasks = getTasks();
                    tasks = tasks.filter(task => task.id !== taskId);
                    saveTasks(tasks); // Esto tambi√©n refrescar√° el calendario
                    
                    card.style.transform = 'scale(0.8)';
                    card.style.opacity = '0';
                    setTimeout(() => card.remove(), 300);
                }
            });
            taskGrid.addEventListener('change', (e) => {
                if (e.target.classList.contains('task-checkbox')) {
                    const card = e.target.closest('.task-card');
                    const taskId = card.dataset.id;
                    const isCompleted = e.target.checked;
                    let tasks = getTasks();
                    const taskIndex = tasks.findIndex(task => task.id === taskId);
                    if (taskIndex > -1) {
                        tasks[taskIndex].completed = isCompleted;
                        saveTasks(tasks); // No refresca el calendario, solo guarda
                    }
                    card.classList.toggle('completed', isCompleted);
                }
            });
            
            // --- 6. *** NUEVO *** FUNCIONES DE TARJETA FLOTANTE ---
            
            function updateCardPosition(mouseX, mouseY) {
                if (!dataCardContainer) return;
                const cardWidth = dataCardContainer.offsetWidth;
                const cardHeight = dataCardContainer.offsetHeight;
                
                let newX = mouseX + 15; // Ligeramente a la derecha del cursor
                let newY = mouseY - (cardHeight / 2); // Centrado verticalmente

                // Evita que se salga por la derecha
                if (newX + cardWidth > window.innerWidth) {
                    newX = mouseX - cardWidth - 15; // Mueve a la izquierda
                }
                
                // Evita que se salga por abajo
                if (newY + cardHeight > window.innerHeight) {
                    newY = window.innerHeight - cardHeight - 10;
                }
                // Evita que se salga por arriba
                if (newY < 10) {
                    newY = 10;
                }

                dataCardContainer.style.transform = `translate(${newX}px, ${newY}px)`;
            }

            function showTaskHoverCard(event, task) {
                const formattedDate = new Date(task.date).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' });
                
                cardTitle.textContent = task.title;
                cardSubtitle.textContent = `üìÖ ${formattedDate} - üïí ${task.time || 'Todo el d√≠a'}`;
                cardDescription.textContent = task.desc || '(Sin descripci√≥n)';
                cardStats.innerHTML = ''; // Limpia los stats de "Impacto"
                
                dataCardContainer.classList.add('visible');
                updateCardPosition(event.clientX, event.clientY);
            }

            function hideTaskHoverCard() {
                dataCardContainer.classList.remove('visible');
            }
            // --- 6. FUNCI√ìN DE RENDERIZADO DE ACTIVIDADES UAO ---
            const renderUniversityActivities = (activities) => {
                const gridContainer = document.getElementById('uni-activities-grid');
                if (!gridContainer) return; // Aseguramos que el contenedor exista

                activities.forEach((activity, index) => {
                    const card = document.createElement('div');
                    card.classList.add('uni-activity-card', 'anim-fade-grow');
                    card.style.animationDelay = `${0.4 + index * 0.15}s`; // Peque√±o retraso secuencial

                    card.innerHTML = `
                        <div class="card-image-container">
                            <img src="${activity.image_url}" alt="${activity.title}">
                        </div>
                        <div class="card-content">
                            <h3>${activity.title}</h3>
                            <p class="card-date">üìÖ ${activity.date}</p>
                            <p>${activity.description}</p>
                            <a href="${activity.url}" class="cta-btn buy-btn" style="text-align: center;">
                                <span>Inscribirse</span>
                            </a>
                        </div>
                    `;
                    gridContainer.appendChild(card);
                });
            };

            

            // --- 6. FUNCI√ìN PRINCIPAL PARA CARGAR Y RENDERIZAR LOS DATOS ---
            const loadDataAndRender = async () => {
                try {
                    // Carga el archivo JSON
                    const response = await fetch('Data.json');
                    const data = await response.json();
                    
                    // Llama a la funci√≥n que renderiza las nuevas actividades de la UAO
                    if (data.university_activities) {
                        renderUniversityActivities(data.university_activities);
                    }
                    
                    // NOTA: Si tienes l√≥gica para el header o footer, ir√≠a aqu√≠.
                    
                } catch (error) {
                    console.error('Fallo al cargar las actividades UAO:', error);
                }
            };
            
            // --- 7. INICIALIZACI√ìN ---

            // --- 7. INICIALIZACI√ìN ---
            renderMainCalendar(mainCalYear, mainCalMonth);
            loadTasks(); 
            loadDataAndRender();

        });
    </script>
</body>
</html>